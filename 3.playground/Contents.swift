import UIKit

// Day 3
// https://adventofcode.com/2020/day/3


func buildInput(from rawMap: String) -> [[String]] {
    let rows = rawMap.split(separator: "\n").map{ $0.trimmingCharacters(in: .whitespaces) }
    return rows.map{ $0.map{ String($0) } }
}

func treeEncounters(on map: [[String]], slopeX: Int, slopeY: Int) -> Int {
    var hitBottom = false
    var treeCount = 0
    var x = 0
    var y = 0
    while(!hitBottom) {
        if map[y][x] == "#" {
            treeCount += 1
        }

        x += slopeX
        y += slopeY

        if y >= map.count {
            hitBottom = true
            break
        }

        if x >= map[y].count {
            x -= map[y].count
        }
    }

    return treeCount
}

let rawTestInput = """
    ..##.........##.........##.........##.........##.........##.......
    #...#...#..#...#...#..#...#...#..#...#...#..#...#...#..#...#...#..
    .#....#..#..#....#..#..#....#..#..#....#..#..#....#..#..#....#..#.
    ..#.#...#.#..#.#...#.#..#.#...#.#..#.#...#.#..#.#...#.#..#.#...#.#
    .#...##..#..#...##..#..#...##..#..#...##..#..#...##..#..#...##..#.
    ..#.##.......#.##.......#.##.......#.##.......#.##.......#.##.....
    .#.#.#....#.#.#.#....#.#.#.#....#.#.#.#....#.#.#.#....#.#.#.#....#
    .#........#.#........#.#........#.#........#.#........#.#........#
    #.##...#...#.##...#...#.##...#...#.##...#...#.##...#...#.##...#...
    #...##....##...##....##...##....##...##....##...##....##...##....#
    .#..#...#.#.#..#...#.#.#..#...#.#.#..#...#.#.#..#...#.#.#..#...#.#
"""

let rawInput = """
    ..#..#......#..#.......#...#.#.
    ...##.....##..#..#....#.##.##.#
    ...#...#.##...##.....#.....#.#.
    ..#....#.....#...##.##.###.#...
    .#.....#......#..#.##.#...###..
    #..#..#.#......#...........###.
    #......####.#....##........##..
    .#.......#.....#......#...#....
    ...#...#.....#.......##.....##.
    #...##.........#.#..##..#..#.##
    #.#.##.........#.#..#.#.....###
    .##..##...#....##.....#..#.....
    ........#.......###.#.#.....#.#
    ...#.#....#.##..#...##..##..#..
    ......#....#........######.#...
    .##...#.#...###......#.#.#..#.#
    ........#.##...##.#...#..#...##
    .#..#.#..##....###..#.#.......#
    ..#..##..#.#...#.##......#.....
    ##.....#..##.#.#..#......##...#
    ......................#..#..#..
    ..#.##....####.........###.##..
    ##..###..#...#....#..#.#...#...
    .##.#......#..#....#........#..
    .#.....#..#..#.#.#....#.....##.
    ..........#..#....#..##...#..##
    .#...#.#....#.##..#.....#....#.
    #..............#.#.#..#..#....#
    ...#.#...............##........
    #.#.##...#.##..##.....#........
    ...#.......###..###..#...#..#..
    ####..#.#..##.....##.#.#......#
    .#.#.......#..##.......#.......
    #....#...#.##.#.......#..#.....
    .#...##..#..#..##.......##...#.
    .#..#......#.........#.........
    #.##.#.....#....#..##..#.....#.
    #.#....#.#....#...#.#..#....#..
    #..#.....#.##..#.....#...##...#
    #....#...##.#.........#.#....##
    .......##.##......##.......##..
    #.....#..#........#........#...
    #....#.#..#.#........##.#...#..
    #.......#.#.#.#....#.......##.#
    ...#..###..........#...#.#.###.
    ....#..#....#...#....##.#.....#
    .#..##.....#..#....##..##...#.#
    #.........#....#.#..###...##...
    .#.#.........#.#.......#.#.#..#
    ..........#........##..#.......
    .....#.......#...#.....#..##.##
    ...#.........#.............####
    ##..#...#..#.#......#...#......
    .#..###...#.#.#.#...#...#......
    ....#..##.#....#..#.#..##..##.#
    ..#.......#......#..#.......#..
    ....###......#...##...#....#...
    ..#..#.....#...#..###....#.#..#
    .........##..#.##....#..##..#..
    ##...#...#.#.........##......#.
    ###..#.#....#......##..##.#...#
    .##...##..#.#.#.#......#..#....
    ###......#..#..#.....#..#....#.
    .#.#..##....##........##..#.#..
    ###...####.#....#.......###....
    ..#....###..#.#.#..#.......##..
    .......#.#...#.....#.#....##.#.
    ......#......#.#....#..##..###.
    ....####..........#.....#......
    .###.....#...#..#...##.#...###.
    ...##....##....###....#.#..#.#.
    ##.#..........##.........#.##..
    ..#..#.#.###..##..#....##.....#
    ..#....##.....#...##....###..##
    ....#.......##..#..#..........#
    ............#..#.###..#.#......
    ...........##......#.#.#...#..#
    ...##.##....#...##.##.....#.#..
    .####...#....###...#.....#....#
    .##........#..##..#.#.....#....
    ..................#.....#..##..
    ..###.....#.##..#..#....##...#.
    ...#.##.#.####.#.###.#....#..##
    .#....##..##......####.#####...
    #...#.#....##.........##....#..
    ..#.##.....##.............#.##.
    ###.....#.#..#..#......#.##.#..
    ...#..##.....#...##...#......#.
    .##.#...#......##.#..##....#...
    .....##.....#......#.#.........
    #.....#.....#........##........
    .#......##...#..#.#....###.#..#
    #.####...#....#.........#..#...
    #..##.#.....#.##.##.#....#...#.
    #########..#....#..#...#......#
    ..##..##...###.######...##.##..
    ##.......#.......#.#....###..#.
    .....#...#.######..#.....#.....
    .#......#..#.............#.##.#
    ..###.#.#......##...###........
    .......####.#..##....#........#
    ..#......#.##....##.##....#....
    ....#......#.#....#..#.#.....##
    ####.....#....#.#......#.#.#.##
    #...##....#.#.##.........#....#
    ....#..###......#......#...#...
    .....##.#..#..#...#..#.#.#.....
    .##............#.....#.........
    ##...#..#.....##.#..#..........
    #.....#####.......#..#....#.#..
    .........#..#.....###........#.
    #....#..#...###........#..#.#..
    ...##...#..#...#.##..#.........
    .........#.#.....#.......#...#.
    .#.....#..####....#.##.......##
    ...............##....##.##..##.
    ............#....#....#...##.#.
    ..#...#........#.......#..#....
    ##....####....#.##...#..##..#.#
    .#.#.....#......#.#........#.#.
    ....#......#.#....##..##.......
    .#..#.#..#..##.....#...........
    ..#........#.##..#......##..#..
    ...##.#...#...#..#........#....
    ##..##....#......#...#..#.#.#.#
    ......#.....#..#..#....#.......
    .....##......#..#.#.##...#.....
    ...#.....#.#..........#..##...#
    .####.##....#...........#.....#
    .....###..##...#....##..#...#..
    ..##...#.#...#..........#..#.#.
    ...#..#..............#.##.#....
    ##.#....#...#..#....#..........
    .##..........#..#........#.....
    #...#.#......#...#.....##..#...
    .##...#.#.#....###.####..#....#
    .#......#.#...#.#....#.#...#...
    #....##.###.............#.#....
    ....#.###..##..##.##...##......
    ##....#..###.##.##.....#......#
    ..#..#..#......#..#..#.........
    #.##......#.#....#..#..#.......
    ....#.#...#..###......##.......
    .###.......##.......#....###...
    ..#..#.##..#.#....#..#.#.....#.
    .#..##.##..............#....#..
    #...#.#...#..#.##..##.#.#......
    #...#..#..##..##.###......#....
    .#..#.....#...#....#.....#...#.
    .....#....#..#.....###...#.####
    .#.....#......#...##...#..#....
    .#......#............#.#.......
    ....##....#.#..#..#...#..#.#...
    #...#.....###...##...#.##.....#
    .......#.....#....#.......#...#
    #.......###.......#.#..........
    ...#.#.###.#........#.###...#..
    ....#............#....#..#.....
    #......#.##.#...##.......#..#.#
    .....#....#....#.#.#...###..#..
    .....#.#...#...#.#..#....#.#..#
    .#.......#.#..#...###.......##.
    .......#..#.##.........#.......
    .##.#........#.##...##....#....
    .#....#..#...#......####...#..#
    ...#.....#..##.#..#.#....#....#
    ...##....#........#.#........#.
    .....#....##..#.##..........#..
    #.....#.#.#......##....##.#..#.
    .#.#.##..#.#....##.#....##.....
    .....#.....#..#.#....#..#....##
    ...#........#....#......###.#..
    .....##...#.....##.##.#.#.##...
    ...#.....#####....##.#.#.###.#.
    .#..#.#..##...###.........#.#.#
    #...#...#.#..#...#...........#.
    .##..............#...#..#....#.
    ....###.........#.#.#....#.....
    ..#...##.#.#....##.#..#...#..#.
    ..#.....#.#......#....#......#.
    .......##....#.#.##....#...#..#
    ##.#.#...#..#......#..#..#....#
    ...#.#......#............###.##
    ..###..#..##..#...##........#..
    .#...#...##...#....#....##.#..#
    ..##...####....#....#..#....#.#
    ...#......##....#.........##.#.
    ##.#.......#..#..#.............
    ..#.#.#.#......#...#.#..##.....
    .#..##.....###...##.#..#......#
    ##...#..........#.####....##...
    #..........#...#..##....#......
    ....##...#....#..####...#.##.##
    .#.######...##...#..##.........
    ....##.........#.......##.##...
    .#.....#.#..........##......#..
    ...#..#.#.###..#........#.....#
    ..##..#............##.......#..
    ......##....##..#.##..#.......#
    .......##....#.......#..#...#.#
    #.#......#.###.....#.##........
    .#..##..........#..#.....#.##..
    ..#.#...#....#.........#..##..#
    .#......#.......#...#..#..###..
    ......#.##.....#.#......#....#.
    ....#....#...#.......#...##.##.
    #....#...##...#..##........###.
    ##......#.#..#.......#.......#.
    ...##.##..#......#.###..#.#.##.
    .............#..#.............#
    ..#.......##..#..#....##...#...
    ...............##..##........#.
    ##...#.##.......#....#.......##
    ....##.##.#.#.....##.....##.##.
    #.#......#.......#..#.#..#.....
    ....##....#.##........##.##.#..
    ......##....#..##..#..##....##.
    .............#.....#.......#...
    .......###.......#..........#..
    ......##.#..#.....#.#...#.#...#
    .#...#..#..###.###...#....##...
    #......#..#.#...#...#.....#..##
    .###.....#..#.#......##..#.##..
    .##.#.....#..#.#..#....##......
    #......#..............#.....#.#
    ...#..#....#.....#.....##.#...#
    ......#..##..##.....#...#......
    .....####..#..#.##.......#..#.#
    ###.#.#........#.......#.....##
    ..#.#.#.#...#...#........#....#
    ....##.#.#..#...##.....#......#
    #..#.##....#..#.##..####.......
    ...####.#...#......#......##..#
    #....#.#..###......#..#..##..#.
    ...........#....#...#......#...
    ......###.#.....#.#....#.#...#.
    .......#.##..............#..##.
    ..##...........#..#.#...#.....#
    #..#............##.........#.#.
    .......###.#...#.#...#.#.#...#.
    ..#...##.......#..#......#.#.##
    #.#...#.....#...##.#.#.......##
    .#.#.##...#..##.#......#.......
    #.......#.......#.#....#.....#.
    .....#..#..#.......#..#........
    ##...##...##......#..##.###....
    ..#...#.###.#.###..#.....###...
    .....####.......#.#.....##....#
    ....#....#.#....#...#..#.#..#..
    ..##.....#....#.#.#.###...#....
    ......#.#....#.#..#....#.#..#..
    #...#...#....#.......#......#.#
    #..#.#......#..#...........#.##
    ...............#....#.....#...#
    .#.#.#...#.##...#.#.#..#....#..
    ...#.#.####..##.#...##.........
    ##.........##.##.....##....#...
    ................#...#.##.#.#..#
    .#..#....#...#..#..#..###.#..#.
    ...#..#.##.#.####..........#..#
    ........#....##......#..#.#....
    ........##.........#..#..#..#.#
    #......#.#...#...#...##.....#..
    #...#.....#..#..##.#...#.#.#...
    ....#..##...##.....#...#.#.....
    ..#..##....#....#...#....#.....
    .#..#...##.......###...#...#...
    .#......#......#..##..#..##....
    ....##....#..#.#....#.#..##....
    ###......#...........#.....###.
    .....#...#..##.#..#..#.....#..#
    #.#....#...........#.##..#..###
    #....#...###.#...#..##..#.....#
    .#....#......##.#..#....#.#....
    ....#.#....#..#.#....#..#..#...
    ..#......#..#.#.#....#.........
    .#...#.#.....#........#.#...###
    ....#..##.......#.###....##....
    #.#.......#......#.###........#
    #.........#.....####.##..#..#..
    .#.#..##...#.#.....##.#.#..#...
    .#..#..#..#.##..#...###.#...#..
    .....##..##..##..#.#.#.....###.
    .#..#...#..#......##.#.........
    ....#..##....#.##.........#...#
    ........#...#...###.........##.
    #.........#..##....#.#...#.....
    .......#.......#..#.......#....
    #......##......#.#.##..........
    .#..##..####...#.....####.....#
    ........#.#....#..##..###.#...#
    .#...#...#.........###..#...#.#
    #.........#....##...#..........
    .#.#....#..........#...........
    .#.#..........#.##.....#.##....
    ..#....#...##..###..........##.
    .#.#..#.##..#..#.##.##..##.....
    ........#...#....#...#.#..##...
    ......#......##..#..#.....#..#.
    .##.#....#...#....#...#..##..##
    ##............#..........###...
    ....#.......#.#..#.#####.....#.
    #......#.....#...#........#....
    ..##.....###..#.#.#.#....#....#
    #...#...#.#..#..#....#..#......
    ......#....#...#..#....#####...
    ....#.......##....#....##......
    .....##...#.##.#.....##....#...
    .#....###.#..##...##.##.......#
    ....#.#.#.##.............#..##.
    ...........##......#...#.#.##..
    ....##......#....#....##..##.#.
    .#.#...#.....##.....#.........#
    #.#..........#.......#.##...#..
    ....#.##..#.#....#.....#...#...
    ##.............##.......#.##.#.
    ....#...#.....##...#..........#
    ##..#...#...#.#.##...#.......##
    ..#........#.....###...##..##.#
    .....#...##.#.#.##.....#...#...
    ####.###...##..##...#..#..#..##
    ......#..#..#.........#...#.#..
    ....###.....##.##....#.##.....#
"""

let tree1 = treeEncounters(on: buildInput(from: rawInput), slopeX: 1, slopeY: 1)
let tree2 = treeEncounters(on: buildInput(from: rawInput), slopeX: 3, slopeY: 1)
let tree3 = treeEncounters(on: buildInput(from: rawInput), slopeX: 5, slopeY: 1)
let tree4 = treeEncounters(on: buildInput(from: rawInput), slopeX: 7, slopeY: 1)
let tree5 = treeEncounters(on: buildInput(from: rawInput), slopeX: 1, slopeY: 2)
print(tree1*tree2*tree3*tree4*tree5)
